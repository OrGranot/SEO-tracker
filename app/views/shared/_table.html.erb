<table class="table table-striped" >
  <thead class="bg-white">
    <tr>
      <th class="bg-white sticky-cell-options" scope="col"></th>
      <th class="sticky-cell" scope="col">מילות חיפוש</th>
      <% @website.dates.each do |date| %>
        <th scope="col" class="date"><%= date.strftime('%d/%m/%Y') %></th>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @website.keywords.each do |keyword| %>
    <% last_search = keyword.searches.first %>
    <tr>
      <td class="sticky-cell-options">
        <div class="d-flex gap-1">
          <%= link_to website_keyword_search_create_path(website,keyword), class: "keyword-option" do %>
            <i class="text-primary fa-solid fa-arrows-rotate"></i>
          <% end %>
          <%= link_to website_keyword_path(website, keyword), method: :delete, data: { confirm: 'אתה בטוח? כל המידע יאבד' }, class: "text-danger" do %>
            <i class="btn p-0 text-danger">X</i>
          <% end %>
        </div>
      </td>
      <td class="keyword sticky-cell" scope="row"><%= keyword.key_string %></td>
      <% @website.dates.each do |date| %>
        <% search = keyword.searches.select{|search| search[:date] == date}[0] %>
        <% if search %>
          <% change = 'same-rank' if search.rank.to_i == last_search.rank.to_i
            change = 'lower-rank' if search.rank.to_i > last_search.rank.to_i
            change = 'higher-rank' if search.rank.to_i < last_search.rank.to_i %>
          <td class = "<%= "rank " + change %>"><%= search.rank %></td>
        <% else %>
          <td class = "rank"> - </td>
        <% end %>
        <% last_search = search unless search.nil? %>
      <% end %>
    </tr>
    <% end %>
  </tbody>
</table>
